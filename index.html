<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>برنامج إدارة المواقف - مصطفى</title>
    <!-- تضمين مكتبات React و Tailwind و Lucide Icons -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap');
        body { font-family: 'Cairo', sans-serif; }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        const Icon = ({ name, size = 24, className = "" }) => {
            useEffect(() => {
                if (window.lucide) {
                    lucide.createIcons();
                }
            }, [name]);
            return <i data-lucide={name} style={{width: size, height: size}} className={className}></i>;
        };

        const TollApp = () => {
            const [currentView, setCurrentView] = useState('home');
            const [carAmount, setCarAmount] = useState('');
            const [carResult, setCarResult] = useState(null);
            const [ticketAmount, setTicketAmount] = useState('');
            const [ticketResult, setTicketResult] = useState(null);
            const [counterType, setCounterType] = useState(null);
            const [counterInputs, setCounterInputs] = useState({});

            // --- منطق الحسابات المحدث (الملاكي بـ 10) ---
            const calculateCars = () => {
                let aa = parseInt(carAmount);
                if (isNaN(aa)) return;
                let al = 0, mk = 0, rn = 0, sh = 0, fr = 0, gr = 0, bs = 0;
                
                // تم تعديل المنطق ليتناسب مع سعر الملاكي (10ج)
                if (aa >= 10 && aa % 5 === 0) {
                    let remaining = aa;
                    if (remaining >= 1000) {
                        let a1a = Math.floor(remaining / 1000);
                        al = a1a * 15; mk = a1a * 10; rn = a1a * 10; sh = a1a * 10; fr = a1a * 5; gr = a1a * 5; bs = a1a * 2;
                        remaining %= 1000;
                    }
                    if (remaining >= 100) {
                        let a2a = Math.floor(remaining / 100);
                        al += a2a * 4; mk += a2a * 2; rn += a2a; sh += a2a;
                        remaining %= 100;
                    }
                    if (remaining >= 10) {
                        let a3a = Math.floor(remaining / 10);
                        al += a3a;
                        if (remaining % 10 === 5) { al -= 1; bs += 1; }
                    } else if (remaining === 5) { mk -= 1; sh += 1; }
                }
                
                let totalCalc = (al * 10) + (mk * 15) + (rn * 15) + (sh * 20) + (fr * 30) + (gr * 35) + (bs * 25);
                setCarResult({ al, mk, rn, sh, fr, gr, bs, totalCount: al+mk+rn+sh+fr+gr+bs, totalValue: totalCalc, isValid: totalCalc === aa });
            };

            const calculateTickets = () => {
                let aa = parseInt(ticketAmount);
                if (isNaN(aa)) return;
                let a10a = 0, a15a = 0, a25a = 0, a30a = 0, a35a = 0;
                if (aa >= 10 && aa % 5 === 0) {
                    let remaining = aa;
                    if (remaining >= 1000) {
                        let a1a = Math.floor(remaining / 1000);
                        a10a = a1a * 30; a15a = a1a * 12; a25a = a1a * 8; a30a = a1a * 6; a35a = a1a * 4;
                        remaining %= 1000;
                    }
                    if (remaining >= 100) {
                        let a2a = Math.floor(remaining / 100);
                        a10a += a2a * 3; a15a += a2a; a25a += a2a; a30a += a2a;
                        remaining %= 100;
                    }
                    if (remaining >= 10) {
                        let a3a = Math.floor(remaining / 10);
                        a10a += a3a;
                        if (remaining % 10 === 5) { a10a -= 1; a15a += 1; }
                    } else if (remaining === 5) { a10a -= 1; a15a += 1; }
                }
                let totalCalc = (a10a * 10) + (a15a * 15) + (a25a * 25) + (a30a * 30) + (a35a * 35);
                setTicketResult({ a10a, a15a, a25a, a30a, a35a, totalCount: a10a+a15a+a25a+a30a+a35a, totalValue: totalCalc, isValid: totalCalc === aa });
            };

            const handleCounterChange = (key, value) => setCounterInputs(p => ({...p, [key]: value}));

            const calculateCounterTotal = (type) => {
                let total = 0, count = 0;
                if (type === 'money') {
                    const bills = [200, 100, 50, 20, 10, 5, 1];
                    bills.forEach(b => total += (parseInt(counterInputs[b] || 0) * b));
                } else if (type === 'cars') {
                    // تم تعديل السعر هنا للملاكي ليصبح 10
                    const prices = {mlaki:10, micro:15, rob:15, shever:20, bus:25, fardi:30, grar:35};
                    Object.keys(prices).forEach(k => {
                        let val = parseInt(counterInputs[k] || 0);
                        total += val * prices[k];
                        count += val;
                    });
                } else if (type === 'tickets') {
                    const tPrices = {t10:10, t15:15, t25:25, t30:30, t35:35};
                    Object.keys(tPrices).forEach(k => {
                        let val = parseInt(counterInputs[k] || 0);
                        total += val * tPrices[k];
                        count += val;
                    });
                }
                return { total, count };
            };

            const Header = ({ title, iconName }) => (
                <div className="bg-gradient-to-l from-blue-700 to-blue-500 text-white p-5 pt-8 pb-6 flex items-center shadow-lg rounded-b-[2rem] mb-4">
                    {currentView !== 'home' && (
                        <button onClick={() => counterType ? setCounterType(null) : setCurrentView('home')} className="ml-4 hover:bg-white/20 p-2 rounded-full transition-colors">
                            <Icon name="arrow-right" />
                        </button>
                    )}
                    <div className="flex-1 text-center flex items-center justify-center gap-2">
                        <Icon name={iconName} />
                        <h1 className="text-xl font-bold">{title}</h1>
                    </div>
                    <div className="w-10"></div>
                </div>
            );

            const Card = ({ label, value, subLabel }) => (
                <div className="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 flex justify-between items-center mb-3">
                    <div>
                        <div className="font-bold text-gray-800 text-lg">{label}</div>
                        {subLabel && <div className="text-xs text-gray-500">{subLabel}</div>}
                    </div>
                    <div className="text-2xl font-black text-blue-600">{value}</div>
                </div>
            );

            if (currentView === 'home') {
                return (
                    <div className="max-w-md mx-auto min-h-screen bg-gray-50" dir="rtl">
                        <div className="bg-gradient-to-br from-blue-800 to-blue-600 text-white p-8 pt-12 pb-16 rounded-b-[3rem] shadow-lg mb-6 text-center">
                            <div className="w-20 h-20 bg-white/20 rounded-full mx-auto mb-4 flex items-center justify-center border-2 border-white/30">
                                <Icon name="wallet" size={40} />
                            </div>
                            <h2 className="text-3xl font-black mb-1">مرحباً يا مصطفى</h2>
                            <p className="text-blue-100 text-sm font-medium">إدارة المواقف (الملاكي 10ج)</p>
                        </div>
                        <div className="px-6 -mt-10 space-y-4 pb-10">
                            {[
                                {id: 'cars', t: 'برنامج السيارات', s: 'توزيع الإيراد على السيارات', c: 'bg-blue-500', i: 'car'},
                                {id: 'tickets', t: 'برنامج التذاكر', s: 'حساب فئات التذاكر', c: 'bg-emerald-500', i: 'ticket'},
                                {id: 'counters', t: 'برنامج العدادات', s: 'حاسبة النقدية والعدد', c: 'bg-purple-500', i: 'calculator'}
                            ].map(item => (
                                <button key={item.id} onClick={() => setCurrentView(item.id)} className="w-full bg-white p-5 rounded-2xl shadow-sm flex items-center justify-between group active:scale-95 transition-all border border-gray-100">
                                    <div className="flex items-center">
                                        <div className={`p-4 rounded-2xl ${item.c} ml-5 text-white`}><Icon name={item.i} size={28}/></div>
                                        <div className="text-right">
                                            <div className="text-lg font-bold text-gray-800">{item.t}</div>
                                            <div className="text-xs text-gray-400">{item.s}</div>
                                        </div>
                                    </div>
                                    <Icon name="chevron-left" className="text-gray-300" />
                                </button>
                            ))}
                        </div>
                    </div>
                );
            }

            if (currentView === 'cars') {
                return (
                    <div className="max-w-md mx-auto min-h-screen bg-gray-50 pb-10" dir="rtl">
                        <Header title="توزيع السيارات" iconName="car" />
                        <div className="p-4">
                            {!carResult ? (
                                <div className="bg-white p-8 rounded-3xl shadow-sm text-center">
                                    <label className="block text-gray-600 font-bold mb-4">المبلغ الإجمالي</label>
                                    <input type="number" value={carAmount} onChange={e => setCarAmount(e.target.value)} className="w-full p-4 border-b-2 text-4xl font-black text-center text-blue-600 focus:outline-none mb-6" placeholder="0"/>
                                    <button onClick={calculateCars} className="w-full bg-blue-600 text-white py-4 rounded-2xl font-bold text-xl">احسب</button>
                                </div>
                            ) : (
                                <div className="space-y-2">
                                    <div className="bg-blue-600 p-6 rounded-3xl text-center text-white mb-4">
                                        <div className="text-4xl font-black">{carAmount} ج.م</div>
                                    </div>
                                    <Card label="ملاكي" value={carResult.al} subLabel="10 ج" />
                                    <Card label="ميكروباص" value={carResult.mk} subLabel="15 ج" />
                                    <Card label="ربع نقل" value={carResult.rn} subLabel="15 ج" />
                                    <Card label="شيفر" value={carResult.sh} subLabel="20 ج" />
                                    <Card label="أوتوبيس" value={carResult.bs} subLabel="25 ج" />
                                    <Card label="فردي" value={carResult.fr} subLabel="30 ج" />
                                    <Card label="جرار" value={carResult.gr} subLabel="35 ج" />
                                    <button onClick={() => {setCarResult(null); setCarAmount('');}} className="w-full mt-4 bg-gray-200 py-4 rounded-2xl font-bold text-gray-600">جديد</button>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            if (currentView === 'tickets') {
                return (
                    <div className="max-w-md mx-auto min-h-screen bg-gray-50 pb-10" dir="rtl">
                        <Header title="برنامج التذاكر" iconName="ticket" />
                        <div className="p-4">
                            {!ticketResult ? (
                                <div className="bg-white p-8 rounded-3xl shadow-sm text-center">
                                    <input type="number" value={ticketAmount} onChange={e => setTicketAmount(e.target.value)} className="w-full p-4 border-b-2 text-4xl font-black text-center text-emerald-600 focus:outline-none mb-6" placeholder="0"/>
                                    <button onClick={calculateTickets} className="w-full bg-emerald-600 text-white py-4 rounded-2xl font-bold text-xl">احسب</button>
                                </div>
                            ) : (
                                <div className="space-y-2">
                                    <div className="bg-emerald-600 p-6 rounded-3xl text-center text-white mb-4"><div className="text-4xl font-black">{ticketAmount} ج.م</div></div>
                                    <Card label="فئة 10" value={ticketResult.a10a} />
                                    <Card label="فئة 15" value={ticketResult.a15a} />
                                    <Card label="فئة 25" value={ticketResult.a25a} />
                                    <Card label="فئة 30" value={ticketResult.a30a} />
                                    <Card label="فئة 35" value={ticketResult.a35a} />
                                    <button onClick={() => {setTicketResult(null); setTicketAmount('');}} className="w-full mt-4 bg-gray-200 py-4 rounded-2xl font-bold text-gray-600">جديد</button>
                                </div>
                            )}
                        </div>
                    </div>
                );
            }

            if (currentView === 'counters') {
                if (!counterType) {
                    return (
                        <div className="max-w-md mx-auto min-h-screen bg-gray-50" dir="rtl">
                            <Header title="العدادات" iconName="calculator" />
                            <div className="p-6 space-y-4">
                                <button onClick={() => setCounterType('money')} className="w-full bg-white p-6 rounded-2xl shadow-sm flex items-center gap-4"><Icon name="banknote" className="text-yellow-500" /> جرد النقدية</button>
                                <button onClick={() => setCounterType('cars')} className="w-full bg-white p-6 rounded-2xl shadow-sm flex items-center gap-4"><Icon name="car" className="text-blue-500" /> عداد السيارات</button>
                                <button onClick={() => setCounterType('tickets')} className="w-full bg-white p-6 rounded-2xl shadow-sm flex items-center gap-4"><Icon name="ticket" className="text-emerald-500" /> عداد التذاكر</button>
                            </div>
                        </div>
                    );
                }
                const { total, count } = calculateCounterTotal(counterType);
                return (
                    <div className="max-w-md mx-auto min-h-screen bg-gray-50 pb-20" dir="rtl">
                        <Header title="العداد" iconName="calculator" />
                        <div className="sticky top-0 bg-white p-4 shadow-md mx-4 rounded-2xl mb-4 flex justify-between items-center z-10">
                            <div><div className="text-xs text-gray-500">الإجمالي</div><div className="text-2xl font-black text-blue-600">{total} ج.م</div></div>
                            {counterType !== 'money' && <div className="bg-blue-50 p-2 rounded-xl text-center font-bold">{count} <span className="text-xs">عدد</span></div>}
                        </div>
                        <div className="p-4 space-y-3">
                            {counterType === 'money' ? [200, 100, 50, 20, 10, 5, 1].map(b => (
                                <div key={b} className="bg-white p-2 rounded-xl border"><label className="text-xs text-gray-400 px-2">{b} جنيه</label><input type="number" onChange={e => handleCounterChange(b, e.target.value)} className="w-full p-2 text-xl font-bold outline-none" placeholder="0"/></div>
                            )) : counterType === 'cars' ? ['mlaki', 'micro', 'rob', 'shever', 'bus', 'fardi', 'grar'].map(c => (
                                <div key={c} className="bg-white p-2 rounded-xl border"><label className="text-xs text-gray-400 px-2 uppercase">{c === 'mlaki' ? 'ملاكي (10ج)' : c}</label><input type="number" onChange={e => handleCounterChange(c, e.target.value)} className="w-full p-2 text-xl font-bold outline-none" placeholder="0"/></div>
                            )) : ['t10', 't15', 't25', 't30', 't35'].map(t => (
                                <div key={t} className="bg-white p-2 rounded-xl border"><label className="text-xs text-gray-400 px-2 uppercase">{t}</label><input type="number" onChange={e => handleCounterChange(t, e.target.value)} className="w-full p-2 text-xl font-bold outline-none" placeholder="0"/></div>
                            ))}
                        </div>
                    </div>
                );
            }
            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TollApp />);
    </script>
</body>
</html>